# swdesign-hw-4

## Сборка
Я пытался собирать jar внутри контейнера, но не получилось, поэтому нужно будет собрать jar отдельно и, потом, залить его в контейнер. `Dockerfile` ожидает, что `build`  папка находится на том же уровне, что и он, поэтому лучше собирать сервисы на том же уровне, что и `Dockerfile`
```
> cd auth
> ./gradlew clean build -x test
> cd ..
> cd ticket
> ./gradlew clean build -x test
> cd ..
> docker compose up --build
```
## О сервисах
#### Сервис `auth`:
- Сервис аутентификации с помощью логина и пароля
- Открыт на порту 8081
- http://localhost:8081/api-docs/swagger-ui - Swagger UI
- БД - `auth` - на порту 5433, СУБД - `PostgreSQL` , креды в `docker-compose.yaml`
- `POST /users/register` - регистрация пользователя
- `POST /users/login` - аутентификация
- `GET /users/{id}` - получение информации о пользователе. Требуется авторизация по JWT. Можно получить только доступных пользователей (в текущей реализации только аутентифицированного).
- База данных инициализируется с помощью schema.sql

#### Сервис `ticket`:
- Сервис аутентификации с помощью логина и пароля
- Открыт на порту 8080
- http://localhost:8080/api-docs/swagger-ui - `Swagger UI`
- БД - `tickets` - на порту 5432, СУБД - `PostgreSQL` , креды в `docker-compose.yaml`
- Все сервисы требует авторизацию по `JWT` токену, полученному из `/users/login`
- `GET /tickets/{id}` - получение информации о билете. Можно получить только билеты, размещенные текущим пользователем.
- `POST /tickets/` - размещение билета. Принимает пункт отправки и назначения. Пользователя достает из `JWT` токена.
- База данных инициализируется с помощью schema.sql
- Для удобства при инициализации создается 1 билет(`71e11470-ce53-4e65-ac83-612f101e1ea2`) и 2 станции(`82a32d32-cce7-4d31-8c8e-669e845ea29b`, `0ee6522e-f2a8-42e8-ae63-837e0a16ec30`)
- Сервис не возвращает список станций)
- Сервис не дает создать станции)

#### Про `JWT` аутентификацию:
- Аутентификации требуют `GET /users/{id}`, `POST /tickets`, `GET /tickets/{Id}`
- В теле токена хранится голый `user_id`, как json-строка.
- TTL токена (захардкожен((( ) равен 1 часу
- Секретный ключ (захардкожен((( )  - `NOTTOOSHORTSECRET`, алгоритм шифрования `HS512`

#### Про статусы билетов

Каждый 5 секунд демон коммонент `TicketExecutor` достает из БД билеты со статусом `CHECK` и с вероятностью:
- 5% - оставляет статус `CHECK`
- 25% - ставит статус `REJECTION`
- 70% - ставит статус `SUCCESS` 

